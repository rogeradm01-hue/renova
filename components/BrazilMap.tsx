import React from 'react';
import { DetranData } from '../types';
import { checkExpirationStatus } from '../services/storageService';
import { useNavigate } from 'react-router-dom';

interface BrazilMapProps {
  data: DetranData[];
}

// Caminhos SVG de alta precisão para o mapa do Brasil (IBGE/Mercator)
const STATE_PATHS: Record<string, string> = {
  AC: "M96.6,245.7l-4.5-2.6l-7.3,0.5l-4.4-3.9l-6.1,1.5l-4.2-2l-3.2,3.2l-6.8-2l-4.4,3l-5.7-2.7l-8.8,6.2l-0.3,5.3l3.5,4.4l0.9,6.8l6.1,1.8l9.1-2.7l4.4,4.7l14.4-6.1l6.5,2l5.9-4.1l5.6,2l6.1-2.3l2.3-5L96.6,245.7z",
  AL: "M536.8,225.5l-2.6,0.6l-3.3,7.6l-7.1,1.5l-0.9-2.7l-7.9-2l-3.5-3.8l1.2-3.3l5-2.9l7.6-1.8l7.1,0.3l4.4,6.5L536.8,225.5z",
  AP: "M368.5,59.3l3.8,5.6l9.4,3.3l6.5,13.9l12,1.5l2.7-2l0.6-6.1l-4.4-12l-9.4-13.6l-7.9-5l-6.1,2.3l-5.9,9.1L368.5,59.3z",
  AM: "M97.7,245.7l6.8-0.6l2.3,5l7.3,4.7l10.3-4.4l11.7,5.6l6.1-3.3l11.4,4.4l7.6-2.9l3.8-4.4l2.7,1.8l2.9-5.6l-4.1-10.3l11.2-5.9l1.8-6.5l-2.9-5.9l3.3-6.5l-2-5.3l3.3-7.1l9.1-3.8l5,2.4l7.1-2.3l4.7-5l3.5,2.3l4.1-2.6l8.6,2.9l0.9-2.6l-3.5-8l3.3-1.8l0.9-3.8l-4.1-2l1.5-11.4l-2.9-5.6l2.3-6.5l6.1-2.3l3.3-5.9l-5-6.5l2.9-2l-1.2-2.9l-4.7-0.9l-2.7,5l-10,3.3l-7.1-2l-5,2.3l-7.6-5l-4.7,2.6l-7.1-2.3l-2.9,2l-5-4.7l-7.3,1.2l-3.5-3.3l-5.3,1.8l-4.1,7.6l-6.5-0.6l-3.5,2.9l-10.6,1.8l-1.8,3.3l-6.8-2l-3.5,3.5l-2.7-1.2l-2.7,2.7l-7.3-4.1l-6.1,4.1l-4.4-2.7l-7.1,5l-9.4,2.3l-5.6,7.1l-1.2,7.6l5.3,4.4l4.7,0.3l2,5l-3.8,5.9l1.8,4.7l-5.3,4.4l-0.9,5.9l5,6.8l2.7,10l11.4,5.3l-2.7,7.6l2.3,6.5l14.1,5.9l7.3-2.3l3.3,4.7L97.7,245.7z",
  BA: "M434.9,267.8l5.6-2.7l3.8-6.5l-0.9-12.3l6.1-6.5l12.3-1.2l4.1,2.9l8.2-1.8l3.8-5.9l8.6,0.3l0.9-4.4l-5.9-8.2l-2-6.8l2.9-4.7l11.2-2.7l3.3-4.4l4.4-1.8l6.1,1.8l5.9,5l2.7,8.6l-0.9,5l3.8,2.3l3.3,5.9l7.9,2l2.7,4.4l0.9,8.6l-4.1,14.4l-4.1,6.8l-2.3,10l-4.1,4.1l2,7.9l-2.7,7.9l-6.1,4.1l-7.9,1.8l-1.2,3.5l-8.8,2.7l-5.6,9.1l-4.4,1.8l-5.3-0.6l-8.6-11.2l-7.1-4.4l-8.6,1.2l-9.7-8.8l-3.8-7.6L434.9,267.8z",
  CE: "M502.8,119.5l2.3,4.4l7.1,1.2l0.9,5l-1.2,6.8l5,5.9l3.3,0.6l5-2.9l4.4,2.9l3.8-1.2l3.5-3.8l-1.5-9.1l1.5-5l-2.9-5l-5.9-4.1l-3.3-5l-9.1-1.8l-7.1,3.3l-3.5,7.1L502.8,119.5z",
  DF: "M375,249.9l-2.7,1.8l1.2,3.5l4.1-0.6l1.8-2.9L375,249.9z",
  ES: "M498.4,320.5l-2.3,1.8l-2.9,6.8l2,5.6l6.8-2l3.5-6.8l0.9-4.7l-3.5-3.3L498.4,320.5z",
  GO: "M363.3,219.2l7.1-2.7l5.9,3.8l4.1-2l2.7-4.4l6.1-1.2l4.1,3.5l5.3,0.6l6.5-5l9.1,1.5l5.9,4.7l1.2,4.4l-1.5,5.9l5.3,10l-2.7,5.9l1.2,5.3l-4.1,1.8l-0.3,7.9l-5.3,5.9l-2.7,10.3l-6.8,2.7l-2.3-3.2l-3.3,3.3l-4.4-2.3l-5,2.3l-7.1-4.4l-3.8-6.5l-2.9-1.8l-4.4,3.3l-7.6-1.8l-2-5.6l-4.4,0.3l-5.6-6.5l3.5-5.6l4.1-0.6l2.3-5.3l2.7,1.2l1.8-5.6l5.3-4.4L363.3,219.2z",
  MA: "M433.2,90l0.3,14.4l-3.3,5.6l2,7.9l-2.3,4.4l4.4,8.6l-0.9,5l2.9,6.5l5.9,1.2l2.9-3.3l6.1,0.9l3.8,5.6l3.3-1.2l6.1,2.9l4.7-5l2-6.8l-2.3-7.6l2.3-3.8l-1.2-3.8l3.3-1.8l-1.5-6.8l5-6.5l-0.9-4.1l-4.4-2.9l-5-6.8l-5.9,1.5l-8.3-6.5l-7.1,1.5l-8.3-0.6l-4.1,3.5l-3.5-1.5L433.2,90z",
  MT: "M270.8,191.1l6.1,1.8l2-4.1l12,2.9l5.9-3.5l7.1,0.9l2.3,3.8l4.1-0.9l2.7-5.3l3.3,1.2l2-3.8l6.8-2l1.5,4.4l5.3,1.2l3.3-2.3l4.1,2.9l4.7-2l-1.2,7.6l4.7,1.5l5,7.6l5.3,1.8l5,10.3l2.9-2.7l4.4,4.7l2,7.1l-5.9,5l-5.9,4.7l-2,6.5l-5.3,1.5l-5,6.8l-4.1,0.3l-13.6,7.6l-6.5,2l-0.6-3.8l-7.1-1.8l-5.9,2.3l-3.3-3.3l-5,2.3l-9.1-6.5l-4.1-7.6l-5.9-2.7l-5,2.9l-0.9-6.5l-5.9-6.1l-0.3-5l7.1-7.6l-6.1-10.9l3.3-7.6l-2.9-5l4.1-5.9L270.8,191.1z",
  MS: "M299.7,354.4l11.2-6.1l6.8-7.6l1.8-8.6l5.3-3.8l6.8,0.3l9.7-8.8l9.4,0.3l3.5-7.9l5.6,2.3l6.1-4.7l8.3-0.6l5.3,5l7.9-2.3l2.7-4.4l5.3,2.3l4.4-2.3l3.5,4.7l2.3-5l6.1-2.3l2.3,3.8l2.3,6.8l-2.9,1.8l-1.2,8.3l-3.8,1.5l-3.5,5.9l-5.6,1.5l-4.1,6.1l-5,2.3l-4.7,6.8l-2.3,9.1l-5.6,2.9l-14.4,14.4l-7.3,2.3l-7.3-4.4l-7.1,3.5l-4.4-1.5l-9.4,2.9l-3.8-2.3l-5-0.9l-4.1-4.7L299.7,354.4z",
  MG: "M423.9,292.3l9.1,9.1l6.5-0.9l7.6,5.6l5.9-1.2l2.9,4.1l5.9,0.3l4.1-4.1l-0.9-9.4l7.1-2l-1.5-8.8l4.4-5.3l2.3,2.9l1.2-3.8l5-0.6l2.9-4.4l5.6,0.3l4.4-2.9l5,2.9l1.5-3.5l-3.5-9.1l-1.8-9.4l-5.6-2.7l-3.8-6.1l-5-0.6l-5.9-5.6l-12,1.5l-7.1,7.1l-2,6.5l-6.8,2.7l-0.3,5.6l-5,1.5l-1.8,5l-5.3,0.6l-1.5,7.1l-4.4,2.3l-4.7-2l-2.3,4.7l-3.5-4.4L423.9,292.3z",
  PA: "M270.8,191.1l5-9.4l12-16.1l0.9-6.5l6.1-2.7l2.9-7.6l-4.1-5.6l2.3-7.6l-2.7-10.3l4.7-5l0.9-7.1l5.6-4.7l-1.8-5l3.8-6.5l-1.8-5.6l-4.7-0.3l-5.6-4.4l0.9-7.3l5.3-7.1l10-2.7l6.8-4.4l6.5,3.8l5.6-4.4l3.5,2.7l7.1,0.3l2,3.2l8.6-1.8l5.6,2.3l4.4-1.8l6.1,1.5l5.6,5.6l6.1-0.6l6.5,5.9l5.6,2l2.7-3.5l5.9,2.7l0.3,5.9l-2.9,2.3l-4.4-2l-3.5,2.7l-2,4.7l3.2,2.9l1.8,5.9l-3.2,5l2.3,3.5l-0.9,4.4l-5,7.6l-5,2.9l0.9,4.1l5,6.5l1.8,6.1l-3.2,2l1.2,3.8l-2.3,3.5l2.3,7.6l-2.3,6.8l-4.4,4.7l-6.1-2.9l-3.5,1.5l-3.5-5.6l-6.5-1.2l-5.3,5.9l-1.5-4.4l-7.1,2l-1.8,3.8l-2.9-1.2l-2.9,5l-3.8,1.2l-2.7-4.1l-7.3-0.9l-5.9,3.5l-11.4-2.9l-2.3,4.1L270.8,191.1z",
  PB: "M522.9,131l3.5,7.1l-3.2,2l-1.5,4.7l-9.7-1.8l-5.3-2.3l-0.9-4.4l-2-4.1l2.9-2.9l4.4,0.3l2.3-2.9L522.9,131z",
  PR: "M363.9,378.4l3.2-6.5l6.1-2.9l7.3-0.3l2-4.4l7.1-0.9l3.2-5.6l4.4-1.5l6.1,2.7l3.2,4.7l8.6-2.7l2.3-3.8l4.7,0.3l3.5,5.9l5.6,2.9l1.5,9.1l-7.1,2.3l-1.5,5l-5.3,1.8l-5.6,6.8l-5,0.3l-7.6-2.7l-9.4,3.8l-7.3-3.2l-7.3,2.7l-6.8-4.4l-3.2-5L363.9,378.4z",
  PE: "M533.8,151.2l-5-2.9l-5.6,2l-5.9,4.7l-5.3,1.5l-2.7-2.3l-8.6,1.2l-5.6-2.7l-4.7,1.5l-5.6-5.3l-2.3-4.4l-3.2,1.5l0.9,4.1l5.9,2.7l9.4,2l-0.6,9.1l3.8,6.5l11.2,0.3l7.9-2.9l5.9,0.9l4.1-6.8l2.3-6.5L533.8,151.2z",
  PI: "M433.5,90l3.5,1.5l3.8-3.5l8.3,0.6l7.1-1.5l8.6,6.1l5.6-1.5l5,6.8l4.4,3.2l0.9,4.1l3.5-7.1l7.1-3.3l8.8,1.8l2.9,5l-1.8,5.6l-3.8,1.5l-4.4-3.2l-5,2.9l-3.5-0.6l-5.3-5.9l-6.1-1.5l-4.4,1.8l-5.3-2.3l-8.8,2l-1.8-3.2l-7.3-0.3l-3.5-2.7l-5.3,4.4l-6.1-3.5l-6.8,4.4l-10,2.7l-5.6-0.6l-2.9-6.5l0.9-5l4.4-8.6l2.3-4.4l-2-7.9l3.3-5.6L433.5,90z",
  RJ: "M476.8,344.2l5.6-2.7l8.8-2.7l7.1,3.2l4.4-2.7l4.4,4.7l-5.3,3.8l-6.1,0.9l-8.8-2.7l-4.7-1.2l-3.8-2L476.8,344.2z",
  RN: "M531.1,125.1l1.2-6.5l5-1.5l7.1,6.1l2.9,5.3l-2,5.3l-2.3,2.9l-4.7-0.3l-2.9,2.9l-1.5-4.7l3.5-1.8L531.1,125.1z",
  RS: "M347.6,409.2l9.4,4.7l2,7.1l3.8,1.8l2.9-2.3l7.6,1.5l6.8-5l4.7,0.6l1.5,7.1l11.4,11.7l2.7,7.6l-1.2,11.2l-2.9,2.7l-7.1,4.7l-9.7,2.7l-4.4-2.3l-5,3.5l-5.6-3.2l-5.3,1.8l-3.8-3.5l-12-2.9l-7.3-4.4l-2.3-5.6l2-4.1l-4.7-5.6l1.2-7.6l-2.3-3.5l1.5-6.8l5.3-0.6L347.6,409.2z",
  RO: "M201.8,245.2l5-2.9l6.1,2.9l3.8,7.9l9.7-2.9l4.4,1.5l7.1-3.5l7.3,4.4l7.3-2.3l-2.3-6.5l-2.3-3.8l-6.1,2.3l-2.3,5l-3.5-4.7l-4.4,2.3l-5.3-2.3l-2.7,4.4l-7.9,2.3l-5.3-5l-8.3,0.6l-6.1,4.7l-5.6-2.3l-3.5,7.9l-3.5-4.4l0.3-5.3l-3.2-1.2l-4.1,2.6l-3.5-2.3l-4.7,5l-7.1,2.3l-5-2.4l-9.1,3.8l10.6,8.6l8.3-0.3l4.1,6.5l6.1-0.3l4.4-3.8L201.8,245.2z",
  RR: "M179.6,59.3l10.6-1.8l3.5-2.9l6.5,0.6l4.1-7.6l5.3-1.8l3.5,3.3l7.3-1.2l5,4.7l2.9-2l7.1,2.3l4.7-2.6l7.6,5l5-2.3l7.1,2l10-3.3l-0.9,7.3l-5.6,4.4l-6.5-3.8l-6.8,4.4l-10,2.7l-5.3,7.1l-0.9,7.3l-3.2,5.9l-6.1,2.3l-2.3,6.5l-2.7-10l-5-6.8l0.9-5.9l5.3-4.4l-1.8-4.7l3.8-5.9l-2-5l-4.7-0.3l-5.3-4.4l1.2-7.6l5.6-7.1l9.4-2.3l7.1-5l4.4,2.7l6.1-4.1l7.3,4.1l2.7-2.7L179.6,59.3z",
  SC: "M395.6,387.2l5.6-6.8l5.3-1.8l1.5-5l7.1-2.3l-1.5-9.1l5.6,0.3l3.8,6.1l5.6,2.7l1.8,9.4l-2,6.8l-5.3,7.3l-5.6,3.2l-7.3,0.9l-5-2.3l-7.3-4.1l-5.6,1.5l-7.1-6.5L395.6,387.2z",
  SE: "M519.6,220.8l2,4.1l0.9,4.4l-7.3,2.9l-2.9-5l-0.9-7.6l5,0.3Z",
  SP: "M400.9,352.5l5.6-6.5l4.4-0.3l2,5.6l7.6,1.8l4.4-3.3l2.9,1.8l3.8,6.5l7.1,4.4l5-2.3l4.4,2.3l3.3-3.3l2.3,3.2l6.8-2.7l2-6.5l7.1-7.1l12-1.5l5.9,5.6l5,0.6l3.5,9.1l-1.5,3.5l-5-2.9l-4.4,2.9l-5.6-0.3l-2.9,4.4l-5,0.6l-1.2,3.8l-2.3-2.9l-4.4,5.3l-7.3-3.2l-8.8,2.7l-5.6,2.7l-2.3-4.1l-6.8,0.9l-3.5-3.2l-5.3,1.8l-2.3-3.5l-3.8-1.8l-6.1-2.7l-4.4,1.5l-3.2,5.6l-7.1,0.9l-2,4.4l-7.3,0.3l-6.1,2.9l-3.2,6.5l-7.3,0.3l-1.8-6.1l-6.5-0.9l-6.1,2.9l-3.2,6.5L400.9,352.5z",
  TO: "M382.2,203.1l-1.8,5.6l-2.7-1.2l-2.3,5.3l-4.1,0.6l-3.5,5.6l5.6,6.5l4.4-0.3l2,5.6l7.6,1.8l-7.1,2.7l-14.1,5.9l-2.3,6.5l2.7,7.6l-11.4,5.3l2,3.8l-3.3,1.2l-2.7,5.3l-4.1,0.9l-2.3-3.8l-7.1-0.9l-5.9,3.5l-12-2.9l-2,4.1l-6.1-1.8l-4.1-5.9l2.9,5l-3.3,7.6l6.1,10.9l-7.1,7.6l0.3,5l5.9,6.1l0.9,6.5l5-2.9l5.9,2.7l4.1,7.6l9.1,6.5l5-2.3l3.3,3.3l5.9-2.3l7.1,1.8l0.6,3.8l6.5-2l13.6-7.6l4.1-0.3l5-6.8l5.3-1.5l2-6.5l5.9-4.7l5.9-5l-2-7.1l-4.4-4.7l-2.9,2.7l-5-10.3l-5.3-1.8l-5-7.6l-4.7-1.5l1.2-7.6l-4.7,2l-4.1-2.9l-3.3,2.3l-5.3-1.2l-1.5-4.4l-6.8,2L382.2,203.1z"
};

const BrazilMap: React.FC<BrazilMapProps> = ({ data }) => {
  const navigate = useNavigate();

  const getColor = (uf: string) => {
    const stateData = data.find(d => d.uf === uf);
    
    // Default fallback
    if (!stateData) return '#cbd5e1';

    // 1. Prioridade: Vencido (Preto)
    const isExpired = checkExpirationStatus(stateData);
    if (isExpired && !['Concluída', 'Recadastrado com Sucesso'].includes(stateData.currentStatus)) {
        return '#1f2937'; // Cinza muito escuro/Preto para destacar vencimento
    }

    // 2. Cores por Status
    switch (stateData.currentStatus) {
      case 'Recadastrado com Sucesso': return '#10b981'; // Emerald Green
      case 'Iniciada': return '#f97316'; // Orange
      case 'Concluída': return '#34d399'; // Lighter Emerald
      case 'Em Andamento': return '#1e3a8a'; // Dark Navy Blue
      case 'Pendente': return '#fbbf24'; // Amber
      case 'Não Iniciada':
      default: return '#cbd5e1'; // Slate-300 (Cinza neutro e suave)
    }
  };

  const handleStateClick = (uf: string) => {
    navigate(`/detran/${uf}`);
  };

  return (
    <div className="w-full h-full flex items-center justify-center p-4 relative overflow-hidden bg-white rounded-xl">
      {/* 
         Mapa SVG 2D - Visão Simples com Divisões Claras 
         ViewBox calibrado para coordenadas ~600x600
      */}
      <svg
        viewBox="0 0 600 600"
        xmlns="http://www.w3.org/2000/svg"
        className="w-full h-full max-h-[450px] z-10"
      >
        <g>
          {Object.entries(STATE_PATHS).map(([uf, path]) => (
            <path
              key={uf}
              id={uf}
              d={path}
              fill={getColor(uf)}
              stroke="#ffffff" 
              strokeWidth="1.2"
              strokeLinejoin="round"
              className="hover:brightness-95 transition-all cursor-pointer hover:-translate-y-0.5"
              onClick={() => handleStateClick(uf)}
            >
              <title>{uf} - {data.find(d => d.uf === uf)?.currentStatus}</title>
            </path>
          ))}
        </g>
      </svg>
    </div>
  );
};

export default BrazilMap;